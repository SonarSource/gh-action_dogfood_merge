# Merge Dogfood Branches Action

This action automatically merges branches prefixed with `dogfood/` into the `dogfood-automerge` branch or the branch specified as input.

## Important Notes

⚠️ **This action performs a force push to the target dogfood branch, completely replacing its history based on the dogfood/ branches.**

⚠️ **Branch Naming Requirement**: The name of a dogfood branch should match the name of an existing branch prefixed with `dogfood/`;
otherwise it will be automatically deleted. As an example, to dogfood a branch named `SONAR-XYZ` you need to push two branches to remotes:
`SONAR-XYZ` and `dogfood/SONAR-XYZ`. This is done intentionally to allow developers to continue working on their branch, in this case
`SONAR-XYZ` while dogfooding `dogfood/SONAR-XYZ`.

## Inputs

### `dogfood-branch`

**Optional** The name of the dogfood branch. Defaults to `dogfood-automerge`.

### `github-token`

**Optional** The GitHub token used for authenticating with the GitHub API. This token must have the `contents: write` permission to push
changes to the dogfood branch. It is recommended to use the default GitHub token `${{ github.token }}` over providing a token generated by Vault.

## Outputs

### `dogfood-branch`

The dogfood branch that was updated.

### `sha1`

The HEAD sha1 of the dogfood branch.

## Example workflow

```yaml
name: Dogfood merge
on:
  # Trigger on pushes to the default and dogfood branches
  push:
    branches:
      - master # replace with your repository's default branch
      - 'dogfood/**'
  delete: # Trigger on deletion of dogfood branches, see `if` condition below
jobs:
  dogfood_merge:
    runs-on: sonar-runner-large # SonarSource/gh-action_dogfood_merge uses DinD
    name: Update dogfood branch
    permissions:
      contents: write
    if: github.event_name != 'delete' || startsWith(github.event.ref, 'dogfood/')
    steps:
      - name: Merge dogfood branches
        uses: SonarSource/gh-action_dogfood_merge@v1
        with:
          dogfood-branch: 'dogfood-on-peach'
```
